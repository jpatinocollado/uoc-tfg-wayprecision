<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:shapes="clr-namespace:Microsoft.Maui.Controls.Shapes;assembly=Microsoft.Maui.Controls"
             x:Class="WayPrecision.SettingsPage"
             Title="Configuración">

    <ScrollView>
        <!-- Contenido principal en la parte superior -->
        <VerticalStackLayout Spacing="12" Padding="12">

            <!-- Sección: Localización GPS -->

            <VerticalStackLayout Spacing="8">
                <Label Text="Localización GPS" FontAttributes="Bold" FontSize="Medium" />
                <BoxView HeightRequest="1" Color="LightGray" HorizontalOptions="Fill" Margin="0,4,0,8" />

                <Label Text="Intervalo de posición GPS" FontAttributes="Bold" />
                <Label Text="Rango: 1 – 15 segundos." FontAttributes="Italic" />
                <Label Text="Intervalos más cortos mejoran la precisión pero consumen más batería." FontAttributes="Italic" />
                <Entry x:Name="GpsIntervalEntry"
                               Keyboard="Numeric"
                               Placeholder="Introduce el intervalo en segundos" />

                <Label Text="Precisión mínima requerida"  FontAttributes="Bold" />
                <Label Text="Rango: 0 – 20 metros. 0 desactiva el filtro." FontAttributes="Italic" />
                <Label Text="Mayor precisión mejora el cálculo geométrico pero rechaza más posiciones." FontAttributes="Italic" />
                <Entry x:Name="GpsAccuracyEntry"
                               Keyboard="Numeric"
                               Placeholder="Introduce la precisión en metros" />
            </VerticalStackLayout>

            <!-- Sección: Cálculo Geométrico -->

            <VerticalStackLayout Spacing="8" Padding="0,15,0,0">
                <Label Text="Cálculo Geométrico" FontAttributes="Bold" FontSize="Medium" />
                <BoxView HeightRequest="1" Color="LightGray" HorizontalOptions="Fill" Margin="0,4,0,8" />
                <Label Text="Unidad de área"  FontAttributes="Bold" />
                <Picker x:Name="AreaUnitsPicker" />

                <Label Text="Unidad de longitud"  FontAttributes="Bold" />
                <Picker x:Name="LengthUnitsPicker" />
            </VerticalStackLayout>

            <!-- Sección: Trazados -->
            <VerticalStackLayout Spacing="8" Padding="0,15,0,0" HorizontalOptions="Fill">
                <Label Text="Trazados" FontAttributes="Bold" FontSize="Medium" />
                <BoxView HeightRequest="1" Color="LightGray" HorizontalOptions="Fill" Margin="0,4,0,8" />

                <Label Text="Modo de Tracking"  FontAttributes="Bold" />
                <Label Text="GPS: el seguimiento del track se realiza en función de la señal GPS (Se recomienda activar todos los filtros)" FontAttributes="Italic" />
                <Label Text="Manual: permite dibujar el track haciendo click en el mapa para añadir puntos (Se desactivan todos los filtros)" FontAttributes="Italic" />
                <Label Text="CSV: permite dibujar el track añadiendo la lista de puntos en formato CSV (Se desactivan todos los filtros)" FontAttributes="Italic" />
                <Picker x:Name="TrackingModePicker" />

                <!-- Input de texto multilínea para pegar listas CSV o comentarios -->
                <Label Text="Entrada CSV" FontAttributes="Bold" />
                <Label Text="Pega aquí una lista de puntos en formato CSV (lat,long) por línea." FontAttributes="Italic" />
                <Editor x:Name="CsvEditor"
                     HeightRequest="140"
                     AutoSize="TextChanges"
                     Keyboard="Text"
                     HorizontalOptions="Fill"
                     VerticalOptions="Start" IsVisible="False" />

                <Label Text="Filtro de Outliers" FontAttributes="Bold" />
                <Label Text="Aplica un filtro que elimina posiciones GPS erráticas que generan saltos improbables en la ruta para ofrecer trazados más fiables." FontAttributes="Italic" />

                <!-- Grid para alinear etiqueta a la izquierda y switch a la derecha (compatible con .NET 9) -->
                <Grid ColumnDefinitions="*,Auto">
                    <Switch x:Name="OutliersSwitch"
                     IsToggled="False"
                     Grid.Column="0"
                     HorizontalOptions="End"
                     VerticalOptions="Center"
                            OnColor="{StaticResource Primary300}"
                            ThumbColor="{StaticResource Primary500}" />
                    <Label Text="Habilitar filtro de Outliers"
                           Grid.Column="0"
                           VerticalTextAlignment="Center"
                           VerticalOptions="Center" />
                </Grid>

                <Label Text="Filtro de Kalman" FontAttributes="Bold" />
                <Label Text="Aplica un filtro para reducir el ruido del GPS y suavizar la ruta haciendo que el recorrido se vea más natural, sin zigzags ni cambios bruscos." FontAttributes="Italic" />

                <!-- Grid para alinear etiqueta a la izquierda y switch a la derecha (compatible con .NET 9) -->
                <Grid ColumnDefinitions="*,Auto">
                    <Switch x:Name="KalmanSwitch"
                     IsToggled="False"
                     Grid.Column="0"
                     HorizontalOptions="End"
                     VerticalOptions="Center"
                            OnColor="{StaticResource Primary300}"
                            ThumbColor="{StaticResource Primary500}" />
                    <Label Text="Habilitar filtro de Kalman"
                           Grid.Column="0"
                           VerticalTextAlignment="Center"
                           VerticalOptions="Center" />
                </Grid>

                <Label Text="Filtro Moving Average" FontAttributes="Bold" />
                <Label Text="Aplica un filtro que suaviza la trayectoria con el promedio de las últimas N posiciones para reducir el ruido y pequeños saltos, manteniendo la forma general del trazado." FontAttributes="Italic" />

                <!-- Grid para alinear etiqueta a la izquierda y switch a la derecha (compatible con .NET 9) -->
                <Grid ColumnDefinitions="*,Auto">
                    <Switch x:Name="MovingAvegareSwitch"
                     IsToggled="False"
                     Grid.Column="0"
                     HorizontalOptions="End"
                     VerticalOptions="Center"
                            OnColor="{StaticResource Primary300}"
                            ThumbColor="{StaticResource Primary500}" />
                    <Label Text="Habilitar Moving Average"
                           Grid.Column="0"
                           VerticalTextAlignment="Center"
                           VerticalOptions="Center" />
                </Grid>
            </VerticalStackLayout>

            <Button Text="Guardar"
                     x:Name="SaveButton"
                     Style="{StaticResource PrimaryButton}"
                     Margin="0,24,0,0" />

            <Button x:Name="CancelarButton"
                     Text="Cancelar"
                     Style="{StaticResource TertiaryButton}" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>