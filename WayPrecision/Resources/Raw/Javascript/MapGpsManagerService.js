let MapGpsManagerService = (function () {
    //icono de posición GPS
    let gps = L.icon({
        iconUrl: 'data:image/png;base64,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',
        iconSize: [15, 20],
        iconAnchor: [7, 20],
        popupAnchor: [0, -20],
    });

    let gpsNoDirection = L.icon({
        iconUrl: 'data:image/png;base64,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',
        iconSize: [15, 20],
        iconAnchor: [7, 20],
        popupAnchor: [0, -20],
    });

    let actualPosition = L.layerGroup();

    let getLayer = function () {
        return actualPosition;
    }

    let setGpsPosition = function (lat, lng, center, angle) {
        if (MapManagerService.GetMap().getZoom() <= 1)
            MapManagerService.SetZoomMax();

        let latLang = L.latLng(lat, lng);

        let icon = gpsNoDirection;
        if (angle)
            icon = gps;

        let markerPosition = L.marker(latLang, { icon: icon, rotationAngle: angle })
            .bindPopup('<b>Hola,</b><br>Este eres tú.');
        actualPosition.clearLayers();
        actualPosition.addLayer(markerPosition);
        if (center)
            MapManagerService.SetView(lat, lng);
    }
    let clearGpsPosition = function () {
        actualPosition.clearLayers();
    }

    let removeLayer = function () {
        actualPosition.remove();
    }
    //return plublic methods of service
    return {
        GetLayer: getLayer,
        RemoveLayer: removeLayer,
        SetGpsPosition: setGpsPosition,
        ClearGpsPosition: clearGpsPosition
    };
})();